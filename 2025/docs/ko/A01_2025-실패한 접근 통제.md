#  A01:2025 실패한 접근 통제 ![icon](../assets/TOP_10_Icons_Final_Broken_Access_Control.png){: style="height:80px;width:80px" align="right"}



## 배경(Background). 

실패한 접근통제는 OWASP TOP 10에서 1위를 유지있다. 100%의 테스트된 애플리케이션에서 실패한 접근 통제 취약점이 발견되었으며, 관심이 갈만한 보안약점(CWE)은 CWE-200: 비인기자에게 민감정보 노출, CWE-201: 전송된 데이터로부터 민감정보 노출, CWE-918: 서버측 요청 위조(SSRF), 그리고 CWE-352: 크로스 사이트 요청 위조(CSRF) 가 있다. 이번 카테고리는 제공받은 데이터로부터 높은 발생률을 보이며, 두번째로 높은 관련된 CVE 개수를 보유하고 있다.

## 점수표(Score Table).


<table>
  <tr>
   <td>매칭된 CWEs 
   </td>
   <td>최대 사고 발생률
   </td>
   <td>평균 사고 발생률
   </td>
   <td>최대 커버리지(범위)
   </td>
   <td>평균 커버리지(범위)
   </td>
   <td>평균 공격 심각도
   </td>
   <td>평균 영향도
   </td>
   <td>총 발생률
   </td>
   <td>총 CVE 개수
   </td>
  </tr>
  <tr>
   <td>40
   </td>
   <td>20.15%
   </td>
   <td>3.74%
   </td>
   <td>100.00%
   </td>
   <td>42.93%
   </td>
   <td>7.04
   </td>
   <td>3.84
   </td>
   <td>1,839,701
   </td>
   <td>32,654
   </td>
  </tr>
</table>



## 설명(Description). 

접근통제는 사용자가 의도된 권한을 벗어나는 행위를 하지 못하도록 정책을 강제한다. 실패된 접근통제는 일반적으로 비인가자 정보 유출,  데이터 수정 및 삭제(파괴), 또는 사용자 제한사항에 벗어나는 비즈니스 기능을 수행으로 이어질 수 있다. 흔한 접근 통제 취약점은 리스트는 다음과 같다:

- 최소 권한 원칙 위반, 흔히 알려진 기본적 우선 거부(Deny by Default)는 오직 허가된 기능, 역할, 사용자들에게만 허용된 자원 접근이 가능해야 한다. 그러나 모두에게 허가되거나 권한이 필요없는 자에게도 권한이 부여된 것을 최소 권한 원칙 위반이라 한다.
- 수정된 URL, 내부 애플리케이션 상태, HTML 페이지 또는 공격 도구를 이용한 수정된 API 요청을 이용한 접근통제 우회 체크(파라미터 위조 또는 브라우징 강제)
* 다른 사용자 계정을 조회 또는 수정할 수 있는 고유 식별자 제공(안전하지 않은 직접 객체 참조, Insecure Direct Object References)
* POST, PUT 그리고 DELETE에 대한 접근 가능한 API에 접근 통제 로직이 없는 경우
* 권한 상승. 로그인 과정 없이 다른 유저로 가장하거나 또는 사용자가 보유한 이상의 권한을 획득하는 것(예시. 관리자 접근 권한)
* 메타데이터 위조, JSON 웹 토큰(JWT), 접근 통제 토큰, 쿠키 또는 히든 필드 값을 수정하여 재전송 또는 위조함으로써 권한 상승을 하는 경우 또는 JWT 무효화 남용하는 경우
* 교차 출처 자원 공유 (CORS, Cross-Origin Resource Sharing)의 잘못된 설정은 비인가자 또는 비신뢰 출처로부터 API 접근을 허용한다.
* 브라우징 강제 (URL 예측)는 인증이 필요한 페이지에 인증없이 접근하거나, 권한이 필요한 페이지에 일반 유저가 접근하는 것을 말한다.


## 방어(Prevent). 

접근통제는 공격자가 접근 통제 로직 또는 메타데이터를 수정할 수 없는 곳에서 신뢰할 수 있는 서버측 코드나 서버리스 API들로 구현될 때 효과적이다. 



* 공개 리소스 제외 모든 리소스는 거부 우선 정책(Deny By Default)을 따를 것
* 접근통제 매커니즘을 구현한 후엔 전체 애플리케이션에 재사용하고 교차 출처 자원 검증 사용 최소화 할 것
* 모델 접근 통제는 소유권에 의해 행해져야 하며, 다른 사용자에 의해 레코드 생성, 읽기, 갱신, 삭제가 이루어져선 안 된다.(DAC, 임의 접근 통제)
* 유니크 애플리케이션 비즈니스 요구사항 제한은 도메인 모델에 의해 강제되어야 한다.(Unique application business limit requirements should be enforced by domain models.)
* 웹 서버 디렉토리 리스팅 비활성화 여부, 파일 메타데이터 검증(예시. .git 디렉토리), 그리고 백업 파일이 웹 루트에 존재하는지 확인해야 한다.
* 접근 통제 실패 로그 기록 및 적절한 경우엔 관리자에게 경고 알림 (예시. 반복적 실패 또는 비정상적 접근 시도)
* API 및 컨트롤러 속도 제한 구현 하여 자동화된 공격 툴 피해 최소화
* 상태기반 세션 식별자는 로그아웃 후 무효화되어야 합니다. 상태를 저장하지 않는 JWT 토큰의 경우 짧은 유효시간을 부여하여 공격자를 위한 공격 표면 및 기회를 최소화해야 하고, 유효기간이 긴 JWT 토큰은 리프레쉬 토큰 사용을 고려해야 하며, OAuth 표준에 따른 토큰 취소도 고려하여야 한다.
* 간단하고 선언적 접근 통제를 제공하는 확립된 툴킷과 패턴을 사용해야 한다.
* 개발자와 QA 스태프는 보유 중인 시스템과 통합적 테스트에서 함수적 접근 통제을 포함하여야 한한다.
## 예시 공격 시나리오. 

**시나리오 1:** 어떤 애플리케이션은 계정 정보에 접근하는 SQL 요청에서 검증되지 않은 데이터를 사용한다:


```
pstmt.setString(1, request.getParameter("acct"));
ResultSet results = pstmt.executeQuery( );
```


공격자는 원하는 계정 정보를 전달하기 위해 간단하게 'acct' 파라미터를 변조할 수 있으며, 만약 해당 파라미터가 완벽하게 검증되지 않았을 시 공격자는 모든 사용자 계정 정보에 접근 가능하다.


```
https://example.com/app/accountInfo?acct=notmyacct
```


**시나리오 2:** 공격자는 간단하게 목적 URL 브라우징을 강제할 수 있다. 하지만 관리자 페이지 접근하기 위해선 관리자 권한이 요구된다.


```
https://example.com/app/getappInfo
https://example.com/app/admin_getappInfo
```


먄약 인정되지 않은 유저가 해당 페이지(/app/getappInfo) 접근이 가능하다면, 이건 보안 취약점으로 간주되고, 만약 관리자가 아닌 자가 관리자 페이지 접근이 가능하다면 이것도 보안 취약점으로 간주된다.(/app/admin_getappInfo)

**시나리오 3:** 애플리케이션이 프론트 엔드에서만 접근 제어를 하는 경우. 공격자가 브라우저에서 동작하는 자바 스크립트 코드 때문에 `https://example.com/app/admin_getappInfo` 에 접근할 수 없다면, 커멘드 라인에서 간단하게 curl 명령어를 실행하면 된다:

```
$ curl https://example.com/app/admin_getappInfo
```




## 참조.

* [OWASP 사전 활성화 통제: C1: 접근 통제 구현](https://top10proactive.owasp.org/archive/2024/the-top-10/c1-accesscontrol/)
* [OWASP 애플리케이션 보안 검증 표준: V8 인가](https://github.com/OWASP/ASVS/blob/master/5.0/en/0x17-V8-Authorization.md)
* [OWASP 테스트 가이드: 인증 테스트](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/05-Authorization_Testing/README)
* [OWASP 치트시트: 인증](https://cheatsheetseries.owasp.org/cheatsheets/Authorization_Cheat_Sheet.html)
* [PortSwigger: CORS 잘못된 설정 공격](https://portswigger.net/blog/exploiting-cors-misconfigurations-for-bitcoins-and-bounties)
* [OAuth: 접근 취소](https://www.oauth.com/oauth2-servers/listing-authorizations/revoking-access/)


## 매핑된 보안약점 (CWEs) 리스트

* [CWE-22 제한된 디렉토리의 적절하지 않은 경로 이름('경로 조작')](https://cwe.mitre.org/data/definitions/22.html)

* [CWE-23 상대적 경로 조작](https://cwe.mitre.org/data/definitions/23.html)

* [CWE-36 절대적 경로 조작](https://cwe.mitre.org/data/definitions/36.html)

* [CWE-59 파일 접근 전 적절하지 않은 링크 해석 ('링크 따라가기(following)')](https://cwe.mitre.org/data/definitions/59.html)

* [CWE-61 윤닉스 심볼릭 링크 따라가기(following)](https://cwe.mitre.org/data/definitions/61.html

* [CWE-65 윈도우즈 하드 링크](https://cwe.mitre.org/data/definitions/65.html)

* [CWE-200 비인가자에게 민감 데이터 노출](https://cwe.mitre.org/data/definitions/200.html)

* [CWE-201 전달된 데이터로부터 민감 데이터 노출](https://cwe.mitre.org/data/definitions/201.html)

* [CWE-219 웹 루트 내 민감 데이터 저장](https://cwe.mitre.org/data/definitions/219.html)

* [CWE-276 부적절한 기본 권한 설정](https://cwe.mitre.org/data/definitions/276.html)

* [CWE-281 부적절한 권한 상태 유지](https://cwe.mitre.org/data/definitions/281.html)

* [CWE-282 부적절한 소유권 관리](https://cwe.mitre.org/data/definitions/282.html)

* [CWE-283 검증되지 않은 소유권](https://cwe.mitre.org/data/definitions/283.html)

* [CWE-284 부적절한 접근 통제](https://cwe.mitre.org/data/definitions/284.html)

* [CWE-285 부적절한 인가](https://cwe.mitre.org/data/definitions/285.html)

* [CWE-352 크로스 사이트 요청 위조 (CSRF)](https://cwe.mitre.org/data/definitions/352.html)

* [CWE-359 비인가자에게 개인정보 유출](https://cwe.mitre.org/data/definitions/359.html)

* [CWE-377 안전하지 않은 임시 파일](https://cwe.mitre.org/data/definitions/377.html)

* [CWE-379 안전하지 않은 권한이 부여된 디렉토리에 임시 파일 생성](https://cwe.mitre.org/data/definitions/379.html)

* [CWE-402 새로운 영역 내 내부 자원 전달('자원 유출')](https://cwe.mitre.org/data/definitions/402.html)

* [CWE-424 대체 경로에 대한 부적절한 보호](https://cwe.mitre.org/data/definitions/424.html)

* [CWE-425 직접 요청 ('브라우징 강제')](https://cwe.mitre.org/data/definitions/425.html)

* [CWE-441 의도되지 않은 프록시 또는 중간자](https://cwe.mitre.org/data/definitions/441.html)

* [CWE-497 비인가자 통제 영역에 민감 시스템 정보 노출](https://cwe.mitre.org/data/definitions/497.html)

* [CWE-538 외부 접근 가능한 파일 또는 디렉토리에 민감 데이터 삽입](https://cwe.mitre.org/data/definitions/538.html)

* [CWE-540 소스코드 내 포함된 민감 데이터](https://cwe.mitre.org/data/definitions/540.html)

* [CWE-548 디렉토리 리스팅을 통한 민감 데이터 노출](https://cwe.mitre.org/data/definitions/548.html)

* [CWE-552 외부로부터 접근 가능한 파일 또는 디렉토리](https://cwe.mitre.org/data/definitions/552.html)

* [CWE-566 사용자 통제 가능한 SQL 기본키를 통한 인가 우회](https://cwe.mitre.org/data/definitions/566.html)

* [CWE-601 신뢰할 수 없는 사이트로의 URL 리다이렉션 ('오픈 리다이렉션')](https://cwe.mitre.org/data/definitions/601.html)

* [CWE-615 소스코드 주석 내 민감 데이터 포함](https://cwe.mitre.org/data/definitions/615.html)

* [CWE-639 사용자 통제 가능한 키를 통한 인가 우회](https://cwe.mitre.org/data/definitions/639.html)

* [CWE-668 잘못된 영역으로 자원 유출](https://cwe.mitre.org/data/definitions/668.html)

* [CWE-732 중요 리소스에 부적절한 권한 할당](https://cwe.mitre.org/data/definitions/732.html)

* [CWE-749 위험한 메소드 및 함수 노출](https://cwe.mitre.org/data/definitions/749.html)

* [CWE-862 인가 누락](https://cwe.mitre.org/data/definitions/862.html)

* [CWE-863 부적절한 인가](https://cwe.mitre.org/data/definitions/863.html)

* [CWE-918 서버측 요청 위조 (SSRF)](https://cwe.mitre.org/data/definitions/918.html)

* [CWE-922 안전하지 않은 저장소 내 민감 데이터](https://cwe.mitre.org/data/definitions/922.html)

* [CWE-1275 부적절한 SameSite 속성이 부여된 민감 쿠키](https://cwe.mitre.org/data/definitions/1275.html)
